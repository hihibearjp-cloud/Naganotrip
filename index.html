<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <title>長野旅人手帳</title>
  
  <!-- GitHub Pages Ready: 此單一檔案可直接上傳至 GitHub 並透過 GitHub Pages 託管 -->
  
  <!-- App 模式設定 -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="format-detection" content="telephone=no">
  <link rel="apple-touch-icon" href="https://img.icons8.com/color/192/fuji-mountain.png">

  <!-- 載入核心工具 (使用 CDN，無需安裝) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <style>
    body { 
      font-family: -apple-system, sans-serif;
      -webkit-tap-highlight-color: transparent;
      overscroll-behavior-y: none;
      background-color: #f8fafc;
      user-select: none;
    }
    .pb-safe { padding-bottom: env(safe-area-inset-bottom); }
    .pt-safe { padding-top: env(safe-area-inset-top); }
    .hide-scrollbar::-webkit-scrollbar { display: none; }
    .btn-active:active { transform: scale(0.95); opacity: 0.8; }
  </style>
</head>
<body>
  <div id="root" class="h-[100dvh] w-full bg-slate-50 text-slate-900 overflow-hidden"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    // --- 圖示元件 (SVG) ---
    const Icon = ({ path, color }) => (
      <svg className={`w-6 h-6 ${color}`} fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24">
        {path}
      </svg>
    );

    const paths = {
      book: <path strokeLinecap="round" strokeLinejoin="round" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />,
      money: <path strokeLinecap="round" strokeLinejoin="round" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />,
      pen: <path strokeLinecap="round" strokeLinejoin="round" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />,
      bus: <path strokeLinecap="round" strokeLinejoin="round" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4" />,
      trash: <path strokeLinecap="round" strokeLinejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
    };

    // --- 主程式邏輯 ---
    function App() {
      const [view, setView] = useState('guide');
      const [expenses, setExpenses] = useState([]);
      const [journals, setJournals] = useState([]);
      
      // 輸入欄位狀態
      const [inputName, setInputName] = useState('');
      const [inputCost, setInputCost] = useState('');
      const [inputText, setInputText] = useState('');

      // 初始化：讀取 LocalStorage
      useEffect(() => {
        const savedEx = localStorage.getItem('nagano_ex');
        const savedJo = localStorage.getItem('nagano_jo');
        if (savedEx) setExpenses(JSON.parse(savedEx));
        else setExpenses([
          { id: 1, name: '新幹線 (東京-長野)', cost: 8500, date: '預算' },
          { id: 2, name: '巴士 (往戶隱)', cost: 1400, date: '預算' }
        ]);
        if (savedJo) setJournals(JSON.parse(savedJo));
      }, []);

      // 自動存檔
      useEffect(() => { localStorage.setItem('nagano_ex', JSON.stringify(expenses)); }, [expenses]);
      useEffect(() => { localStorage.setItem('nagano_jo', JSON.stringify(journals)); }, [journals]);

      // 功能函數：記帳
      const addEx = () => {
        if (!inputName || !inputCost) return;
        setExpenses([{ id: Date.now(), name: inputName, cost: parseInt(inputCost), date: new Date().toLocaleDateString() }, ...expenses]);
        setInputName(''); setInputCost('');
      };
      const delEx = (id) => setExpenses(expenses.filter(e => e.id !== id));
      
      // 功能函數：日記
      const addJo = () => {
        if (!inputText) return;
        setJournals([{ id: Date.now(), text: inputText, date: new Date().toLocaleString() }, ...journals]);
        setInputText('');
      };
      const delJo = (id) => setJournals(journals.filter(j => j.id !== id));

      const total = expenses.reduce((sum, i) => sum + i.cost, 0);

      return (
        <div className="flex flex-col h-full max-w-md mx-auto bg-white shadow-2xl">
          
          {/* Header 標題列 */}
          <header className="bg-white/90 backdrop-blur border-b border-slate-100 px-5 py-3 pt-safe sticky top-0 z-20">
            <h1 className="text-lg font-bold text-slate-800 flex items-center gap-2">
              <span className="bg-red-600 text-white w-6 h-6 flex items-center justify-center rounded text-xs">長</span>
              長野旅人手帳
            </h1>
          </header>

          {/* Main 內容區 */}
          <main className="flex-1 overflow-y-auto bg-slate-50 p-4 pb-24 hide-scrollbar">
            
            {/* 1. 攻略頁面 View */}
            {view === 'guide' && (
              <div className="space-y-4">
                {/* Banner */}
                <div className="bg-slate-800 text-white p-5 rounded-2xl shadow-lg relative overflow-hidden">
                  <h2 className="text-xl font-bold relative z-10">長野 Nagano</h2>
                  <p className="text-xs text-slate-300 relative z-10">雪、神社、蘋果派</p>
                  <div className="absolute right-[-10px] bottom-[-20px] text-8xl opacity-10 rotate-12">❄</div>
                </div>

                {/* 巴士資訊 */}
                <div className="bg-white p-4 rounded-xl border border-slate-100 shadow-sm">
                  <h3 className="font-bold text-slate-800 mb-3 flex items-center gap-2">
                    <Icon path={paths.bus} color="text-red-500"/> 戶隱巴士時刻
                  </h3>
                  <div className="grid grid-cols-2 gap-4 text-sm">
                    <div>
                      <span className="block text-xs font-bold text-red-500 mb-1">去程 (長野站發)</span>
                      <div className="font-mono text-slate-600">07:00 · 08:00<br/>09:00 · 10:00</div>
                    </div>
                    <div>
                      <span className="block text-xs font-bold text-blue-500 mb-1">回程 (中社發)</span>
                      <div className="font-mono text-slate-600">13:00 · 14:00<br/>15:00 · 16:00</div>
                    </div>
                  </div>
                  <div className="mt-3 pt-2 border-t border-slate-50 text-xs text-slate-400">
                    * 長野站東口 7 號月台 (單程 ¥1,400)
                  </div>
                </div>

                {/* 行程列表 */}
                <div className="space-y-3">
                  <h3 className="font-bold text-slate-800 ml-1">精華行程</h3>
                  {[
                    {d:"Day 1", t:"戶隱神社", c:"戶隱中社 → 古杉參道 → 吃蕎麥麵"},
                    {d:"Day 2", t:"善光寺與美食", c:"善光寺參拜 → 蘋果派 → 味噌拉麵"},
                    {d:"Day 3", t:"雪猴溫泉", c:"地獄谷野猿公苑 → 小布施甜點"}
                  ].map((p, i) => (
                    <div key={i} className="bg-white p-4 rounded-xl border border-slate-100 shadow-sm">
                      <div className="flex justify-between items-center mb-1">
                        <span className="text-xs font-bold bg-slate-100 px-2 py-0.5 rounded text-slate-500">{p.d}</span>
                        <span className="font-bold text-slate-800 text-sm">{p.t}</span>
                      </div>
                      <p className="text-sm text-slate-500 mt-2">{p.c}</p>
                    </div>
                  ))}
                </div>
              </div>
            )}

            {/* 2. 記帳頁面 View */}
            {view === 'money' && (
              <div className="space-y-4">
                {/* 總金額卡片 */}
                <div className="bg-slate-800 text-white p-6 rounded-2xl shadow-lg text-center">
                  <div className="text-xs text-slate-400 mb-1">總支出 (JPY)</div>
                  <div className="text-4xl font-mono font-bold tracking-tight">¥{total.toLocaleString()}</div>
                  <div className="text-xs text-slate-500 mt-2">約台幣 {(total*0.21).toFixed(0)} 元</div>
                </div>

                {/* 輸入區 */}
                <div className="flex gap-2 bg-white p-3 rounded-xl shadow-sm border border-slate-100">
                  <input value={inputName} onChange={e=>setInputName(e.target.value)} placeholder="項目" className="flex-1 bg-slate-50 px-3 py-2 rounded-lg text-sm outline-none" />
                  <input value={inputCost} onChange={e=>setInputCost(e.target.value)} type="number" placeholder="¥" className="w-20 bg-slate-50 px-3 py-2 rounded-lg text-sm outline-none" />
                  <button onClick={addEx} className="bg-red-500 text-white px-4 rounded-lg font-bold text-xl btn-active">+</button>
                </div>

                {/* 列表區 */}
                <div className="space-y-2">
                  {expenses.map(e => (
                    <div key={e.id} className="bg-white p-4 rounded-xl border border-slate-50 shadow-sm flex justify-between items-center">
                      <div>
                        <div className="font-bold text-slate-700 text-sm">{e.name}</div>
                        <div className="text-xs text-slate-400">{e.date}</div>
                      </div>
                      <div className="flex items-center gap-3">
                        <span className="font-mono font-bold text-slate-700">¥{e.cost.toLocaleString()}</span>
                        <button onClick={()=>delEx(e.id)} className="text-slate-300 hover:text-red-500">
                          <Icon path={paths.trash} color="w-4 h-4"/>
                        </button>
                      </div>
                    </div>
                  ))}
                  {expenses.length === 0 && <div className="text-center text-slate-300 py-10 text-sm">尚無紀錄</div>}
                </div>
              </div>
            )}

            {/* 3. 日記頁面 View */}
            {view === 'journal' && (
              <div className="h-full flex flex-col">
                <div className="bg-white p-3 rounded-xl shadow-sm border border-slate-100 mb-4">
                  <textarea value={inputText} onChange={e=>setInputText(e.target.value)} className="w-full h-24 bg-slate-50 rounded-lg p-3 text-sm outline-none resize-none" placeholder="寫點什麼..."></textarea>
                  <div className="flex justify-end mt-2">
                    <button onClick={addJo} disabled={!inputText} className="bg-slate-800 text-white px-4 py-1.5 rounded-lg text-sm font-bold btn-active disabled:opacity-50">發佈</button>
                  </div>
                </div>
                <div className="space-y-3 pb-4">
                  {journals.map(j => (
                    <div key={j.id} className="bg-white p-4 rounded-xl border border-slate-50 shadow-sm relative">
                      <div className="text-xs text-slate-400 mb-2 pb-2 border-b border-slate-50">{j.date}</div>
                      <p className="text-sm text-slate-700 whitespace-pre-wrap leading-relaxed">{j.text}</p>
                      <button onClick={()=>delJo(j.id)} className="absolute top-3 right-3 text-slate-200 hover:text-red-500">
                        <Icon path={paths.trash} color="w-4 h-4"/>
                      </button>
                    </div>
                  ))}
                  {journals.length === 0 && <div className="text-center text-slate-300 py-10 text-sm">還沒有日記，寫一篇吧</div>}
                </div>
              </div>
            )}
          </main>

          {/* Bottom Nav 底部導航 */}
          <nav className="bg-white border-t border-slate-100 pb-safe fixed bottom-0 w-full max-w-md flex justify-around items-center h-16 z-30">
            <button onClick={()=>setView('guide')} className={`flex flex-col items-center w-16 btn-active ${view==='guide'?'text-red-600':'text-slate-300'}`}>
              <Icon path={paths.book} color="currentColor"/>
              <span className="text-[10px] font-bold mt-1">攻略</span>
            </button>
            <button onClick={()=>setView('money')} className={`flex flex-col items-center w-16 btn-active ${view==='money'?'text-red-600':'text-slate-300'}`}>
              <Icon path={paths.money} color="currentColor"/>
              <span className="text-[10px] font-bold mt-1">記帳</span>
            </button>
            <button onClick={()=>setView('journal')} className={`flex flex-col items-center w-16 btn-active ${view==='journal'?'text-red-600':'text-slate-300'}`}>
              <Icon path={paths.pen} color="currentColor"/>
              <span className="text-[10px] font-bold mt-1">日記</span>
            </button>
          </nav>

        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>
